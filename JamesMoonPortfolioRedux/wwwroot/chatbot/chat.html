<!DOCTYPE html>
<!--[if lt IE 7]> <html class="ie6 oldie"> <![endif]-->
<!--[if IE 7]>    <html class="ie7 oldie"> <![endif]-->
<!--[if IE 8]>    <html class="ie8 oldie"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="" style="height: 100%">
<!--<![endif]-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.2">
    <link rel="stylesheet" type="text/css" href="css/botstyle.css">
    <title>Harry, the Houdini Expert</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/datadumper.js"></script>
    <script type="text/javascript" src="js/rivescript.js"></script>
    <script type="text/javascript" src="js/respond.min.js"></script>
</head>
<body>
    <fieldset>
        <legend>Chatroom</legend>
        <div id="dialogue"></div>
    </fieldset>

    <form onSubmit="return sendMessage()">
        <fieldset>
            <legend>Ask a Question</legend>

            <table class="input-table">
                <tr>
                    <td width="960" class="text-box">
                        <input type="text" size="40" name="message" id="message" autocomplete="off" disabled placeholder="Please wait... loading...">
                    </td>
                    <td width="99" class="send-button">
                        <input type="submit" value="Send">
                    </td>
                </tr>
            </table>
        </fieldset>
    </form>



    <script type="text/javascript">

        // Create our RiveScript interpreter.
        var rs = new RiveScript();

        // This won't work on the web!
        //rs.loadDirectory("brain");

        // Load our files from the brain/ folder.
        rs.loadFile("../chatbot/brain/begin.rive", on_load_success, on_load_error);
        rs.loadFile("../chatbot/brain/clients.rive", on_load_success, on_load_error);
        rs.loadFile("../chatbot/brain/myself.rive", on_load_success, on_load_error);
        rs.loadFile("../chatbot/brain/myexpert.rive", on_load_success, on_load_error);

        // You can register objects that can then be called
        // using <call></call> syntax
        rs.setSubroutine('fancyJSObject', function (rs, args) {
            // doing complex stuff here
        });

        function on_load_success() {
            $("#message").removeAttr("disabled");
            $("#message").attr("placeholder", "Send message");
            $("#message").focus();

            $("#dialogue").append("<div class='botText'><span class='bot'>JamesBot:</span> " + "Hi there, I'm James 2.0, James Moon's AI assistant. Incase you are curious, this is possible through James's knowledge of the Rivescript chat library. Now, how can I help you today?" + "</div>");

            // Now to sort the replies!
            rs.sortReplies();
        }

        function on_load_error(err) {
            console.log("Loading error: " + err);
        }

        // Handle sending a message to the bot.
        function sendMessage() {
            var text = $("#message").val();
            $("#message").val("");
            $("#dialogue").append("<div class='userText'><span class='user'>You:</span> " + text + "</div>");
            try {
                var reply = rs.reply("soandso", text);
                reply = reply.replace(/\n/g, "<br>");
                $("#dialogue").append("<div class='botText'><span class='bot'>Harry:</span> " + reply + "</div>");
                $("#dialogue").animate({ scrollTop: $("#dialogue").prop('scrollHeight') }, 1000);
            } catch (e) {
                window.alert(e.message + "\n" + e.line);
                console.log(e);
            }

            return false;
        }


        function escapeHtml(text) {
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        }

    </script>

</body>
</html>
